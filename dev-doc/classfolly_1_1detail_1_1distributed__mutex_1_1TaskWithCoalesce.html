<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>autotier: folly::detail::distributed_mutex::TaskWithCoalesce&lt; Func, Waiter &gt; Class Template Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">autotier
   </div>
   <div id="projectbrief">Automatic Tiering Fuse Filesystem</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><b>folly</b></li><li class="navelem"><b>detail</b></li><li class="navelem"><b>distributed_mutex</b></li><li class="navelem"><a class="el" href="classfolly_1_1detail_1_1distributed__mutex_1_1TaskWithCoalesce.html">TaskWithCoalesce</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="classfolly_1_1detail_1_1distributed__mutex_1_1TaskWithCoalesce-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">folly::detail::distributed_mutex::TaskWithCoalesce&lt; Func, Waiter &gt; Class Template Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="DistributedMutex-inl_8h_source.html">DistributedMutex-inl.h</a>&gt;</code></p>
<div class="dynheader">
Collaboration diagram for folly::detail::distributed_mutex::TaskWithCoalesce&lt; Func, Waiter &gt;:</div>
<div class="dyncontent">
<div class="center"><img src="classfolly_1_1detail_1_1distributed__mutex_1_1TaskWithCoalesce__coll__graph.png" border="0" usemap="#folly_1_1detail_1_1distributed__mutex_1_1TaskWithCoalesce_3_01Func_00_01Waiter_01_4_coll__map" alt="Collaboration graph"/></div>
<map name="folly_1_1detail_1_1distributed__mutex_1_1TaskWithCoalesce_3_01Func_00_01Waiter_01_4_coll__map" id="folly_1_1detail_1_1distributed__mutex_1_1TaskWithCoalesce_3_01Func_00_01Waiter_01_4_coll__map">
<area shape="rect" title=" " alt="" coords="5,213,203,269"/>
<area shape="rect" href="classfolly_1_1detail_1_1distributed__mutex_1_1Waiter.html" title=" " alt="" coords="5,109,203,151"/>
<area shape="rect" href="classfolly_1_1detail_1_1InlineFunctionRef.html" title=" " alt="" coords="7,5,201,47"/>
</map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-types"></a>
Public Types</h2></td></tr>
<tr class="memitem:aba02ef33d8ffe87f307012f46d44fcfb"><td class="memItemLeft" align="right" valign="top"><a id="aba02ef33d8ffe87f307012f46d44fcfb"></a>
using&#160;</td><td class="memItemRight" valign="bottom"><b>ReturnType</b> = decltype(std::declval&lt; const Func &amp; &gt;()())</td></tr>
<tr class="separator:aba02ef33d8ffe87f307012f46d44fcfb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab110d7d65037a120ce89786cdf8b1b7c"><td class="memItemLeft" align="right" valign="top"><a id="ab110d7d65037a120ce89786cdf8b1b7c"></a>
using&#160;</td><td class="memItemRight" valign="bottom"><b>StorageType</b> = <a class="el" href="structfolly_1_1Unit.html">folly::Unit</a></td></tr>
<tr class="separator:ab110d7d65037a120ce89786cdf8b1b7c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a3fc74a797b2d034a82e9fff055b12376"><td class="memItemLeft" align="right" valign="top"><a id="a3fc74a797b2d034a82e9fff055b12376"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>TaskWithCoalesce</b> (Func func, <a class="el" href="classfolly_1_1detail_1_1distributed__mutex_1_1Waiter.html">Waiter</a> &amp;waiter)</td></tr>
<tr class="separator:a3fc74a797b2d034a82e9fff055b12376"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afc7be98fe717ed65432aed604b7fb507"><td class="memItemLeft" align="right" valign="top"><a id="afc7be98fe717ed65432aed604b7fb507"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>operator()</b> () const</td></tr>
<tr class="separator:afc7be98fe717ed65432aed604b7fb507"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:abb7173ad04d17bbca571f3ca629df009"><td class="memItemLeft" align="right" valign="top"><a id="abb7173ad04d17bbca571f3ca629df009"></a>
Func&#160;</td><td class="memItemRight" valign="bottom"><b>func_</b></td></tr>
<tr class="separator:abb7173ad04d17bbca571f3ca629df009"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac2e5cda92ea51c01d349fa126dde4bc5"><td class="memItemLeft" align="right" valign="top"><a id="ac2e5cda92ea51c01d349fa126dde4bc5"></a>
<a class="el" href="classfolly_1_1detail_1_1distributed__mutex_1_1Waiter.html">Waiter</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><b>waiter_</b></td></tr>
<tr class="separator:ac2e5cda92ea51c01d349fa126dde4bc5"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><h3>template&lt;typename Func, typename Waiter&gt;<br />
class folly::detail::distributed_mutex::TaskWithCoalesce&lt; Func, Waiter &gt;</h3>

<p>A template that helps us to transform a callable returning a value to one that returns void so it can be type erased and passed on to the waker. If the return value is small enough, it gets coalesced into the wait struct for optimal data transfer. When it's not small enough to fit in the waiter storage buffer, we place it on it's own cacheline with isolation to prevent false-sharing with the on-stack metadata of the waiter thread</p>
<p>This helps a combined critical section feel more normal in the case where the user wants to return a value, for example</p>
<p>auto value = mutex_.lock_combine([&amp;]() { return data_.value(); });</p>
<p>Without this, the user would typically create a dummy object that they would then assign to from within the lambda. With return value chaining, this pattern feels more natural</p>
<p>Note that it is important to copy the entire callble into this class. Storing something like a reference instead is not desirable because it does not allow <a class="el" href="classfolly_1_1detail_1_1InlineFunctionRef.html">InlineFunctionRef</a> to use inline storage to represent the user's callable without extra indirections</p>
<p>We use std::conditional_t and switch to the right type of task with the CoalescedTask type alias </p>
</div><hr/>The documentation for this class was generated from the following file:<ul>
<li>src/rocksdb/third-party/folly/folly/synchronization/<a class="el" href="DistributedMutex-inl_8h_source.html">DistributedMutex-inl.h</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
