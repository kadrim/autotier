<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>autotier: Rocksdb Tuning Advisor</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">autotier
   </div>
   <div id="projectbrief">Automatic Tiering Fuse Filesystem</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Rocksdb Tuning Advisor </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md823"></a>
Motivation</h1>
<p>The performance of Rocksdb is contingent on its tuning. However, because of the complexity of its underlying technology and a large number of configurable parameters, a good configuration is sometimes hard to obtain. The aim of the python command-line tool, Rocksdb Advisor, is to automate the process of suggesting improvements in the configuration based on advice from Rocksdb experts.</p>
<h1><a class="anchor" id="autotoc_md824"></a>
Overview</h1>
<p>Experts share their wisdom as rules comprising of conditions and suggestions in the INI format (refer <a href="https://github.com/facebook/rocksdb/blob/main/tools/advisor/advisor/rules.ini">rules.ini</a>). Users provide the Rocksdb configuration that they want to improve upon (as the familiar Rocksdb OPTIONS file â€” <a href="https://github.com/facebook/rocksdb/blob/main/examples/rocksdb_option_file_example.ini">example</a>) and the path of the file which contains Rocksdb logs and statistics. The <a href="https://github.com/facebook/rocksdb/blob/main/tools/advisor/advisor/rule_parser_example.py">Advisor</a> creates appropriate DataSource objects (for Rocksdb <a href="https://github.com/facebook/rocksdb/blob/main/tools/advisor/advisor/db_log_parser.py">logs</a>, <a href="https://github.com/facebook/rocksdb/blob/main/tools/advisor/advisor/db_options_parser.py">options</a>, <a href="https://github.com/facebook/rocksdb/blob/main/tools/advisor/advisor/db_stats_fetcher.py">statistics</a> etc.) and provides them to the <a href="https://github.com/facebook/rocksdb/blob/main/tools/advisor/advisor/rule_parser.py">Rules Engine</a>. The Rules uses rules from experts to parse data-sources and trigger appropriate rules. The Advisor's output gives information about which rules were triggered, why they were triggered and what each of them suggests. Each suggestion provided by a triggered rule advises some action on a Rocksdb configuration option, for example, increase CFOptions.write_buffer_size, set bloom_bits to 2 etc.</p>
<h1><a class="anchor" id="autotoc_md825"></a>
Usage</h1>
<h2><a class="anchor" id="autotoc_md826"></a>
Prerequisites</h2>
<p>The tool needs the following to run:</p><ul>
<li>python3</li>
</ul>
<h2><a class="anchor" id="autotoc_md827"></a>
Running the tool</h2>
<p>An example command to run the tool:</p>
<div class="fragment"><div class="line">cd rocksdb/tools/advisor</div>
<div class="line">python3 -m advisor.rule_parser_example --rules_spec=advisor/rules.ini --rocksdb_options=test/input_files/OPTIONS-000005 --log_files_path_prefix=test/input_files/LOG-0 --stats_dump_period_sec=20</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md828"></a>
Command-line arguments</h2>
<p>Most important amongst all the input that the Advisor needs, are the rules spec and starting Rocksdb configuration. The configuration is provided as the familiar Rocksdb Options file (refer <a href="https://github.com/facebook/rocksdb/blob/main/examples/rocksdb_option_file_example.ini">example</a>). The Rules spec is written in the INI format (more details in <a href="https://github.com/facebook/rocksdb/blob/main/tools/advisor/advisor/rules.ini">rules.ini</a>).</p>
<p>In brief, a Rule is made of conditions and is triggered when all its constituent conditions are triggered. When triggered, a Rule suggests changes (increase/decrease/set to a suggested value) to certain Rocksdb options that aim to improve Rocksdb performance. Every Condition has a 'source' i.e. the data source that would be checked for triggering that condition. For example, a log Condition (with 'source=LOG') is triggered if a particular 'regex' is found in the Rocksdb LOG files. As of now the Rules Engine supports 3 types of Conditions (and consequently data-sources): LOG, OPTIONS, TIME_SERIES. The TIME_SERIES data can be sourced from the Rocksdb <a href="https://github.com/facebook/rocksdb/blob/main/include/rocksdb/statistics.h">statistics</a> or <a href="https://github.com/facebook/rocksdb/blob/main/include/rocksdb/perf_context.h">perf context</a>.</p>
<p>For more information about the remaining command-line arguments, run:</p>
<div class="fragment"><div class="line">cd rocksdb/tools/advisor</div>
<div class="line">python3 -m advisor.rule_parser_example --help</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md829"></a>
Sample output</h2>
<p>Here, a Rocksdb log-based rule has been triggered:</p>
<div class="fragment"><div class="line">Rule: stall-too-many-memtables</div>
<div class="line">LogCondition: stall-too-many-memtables regex: Stopping writes because we have \d+ immutable memtables \(waiting for flush\), max_write_buffer_number is set to \d+</div>
<div class="line">Suggestion: inc-bg-flush option : DBOptions.max_background_flushes action : increase suggested_values : [&#39;2&#39;]</div>
<div class="line">Suggestion: inc-write-buffer option : CFOptions.max_write_buffer_number action : increase</div>
<div class="line">scope: col_fam:</div>
<div class="line">{&#39;default&#39;}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md830"></a>
Running the tests</h1>
<p>Tests for the code have been added to the <a href="https://github.com/facebook/rocksdb/tree/main/tools/advisor/test">test/</a> directory. For example, to run the unit tests for db_log_parser.py:</p>
<div class="fragment"><div class="line">cd rocksdb/tools/advisor</div>
<div class="line">python3 -m unittest -v test.test_db_log_parser</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
